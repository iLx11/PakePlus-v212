import{Ct as e,Ft as t,Nt as n,Pt as r,Q as i,Qt as a,Xt as o,bt as s,ct as c,in as l,mt as u,nn as d,rn as f,t as p,vt as m,wt as h,xt as g,zt as _}from"./index-CxDn-bDx.js";import{t as v}from"./KeySelect-ikw7Dje-.js";var y={class:`advanced-key-config`},b={class:`config-header`},x={class:`config-content`},S={class:`config-section main-key-select`},C={class:`key-selection`},w={key:0,class:`key-label`},T={class:`config-section`},E={class:`grid-container`},D={class:`dks-stages-container`},O=[`onMouseenter`,`onMouseleave`],k={class:`stage-name`},A={class:`distance-value`},j={class:`stage-visualization`},M={class:`progress-track`},N={class:`matrix-wrapper`},P={class:`matrix-grid`},F=[`onClick`,`onMousedown`],I={class:`cell-content`},L=p(h({__name:`DKSConfigComp`,setup(p){let h=i(),L=o(Array.from({length:4},()=>Array.from({length:4},()=>({active:!1,isStart:!1,isEnd:!1})))),R=o({isDragging:!1,startRow:-1,startCol:-1,currentCol:-1,progress:0,cellWidth:0}),z=(e,t)=>{if(t===3){B(e,t,t),L[e][t].active=!0,L[e][t].isStart=!0,L[e][t].isEnd=!0;return}B(e,t,3),L[e][t].active=!0,L[e][t].isStart=!0,L[e][t].isEnd=!0},B=(e,t,n)=>{for(let r=t;r<=n;r++)L[e][r].active=!1,L[e][r].isStart=!1,L[e][r].isEnd=!1},V=(e,t,n)=>{t!==3&&(R.cellWidth=n.currentTarget.offsetWidth+8,R.isDragging=!0,R.startRow=e,R.startCol=t,R.currentCol=t,R.progress=0,B(e,t,3),L[e][t].active=!0,L[e][t].isStart=!0,L[e][t].isEnd=!0)},H=e=>{if(!R.isDragging||R.startRow===-1)return;let t=e.clientX,n=document.querySelector(`.matrix-grid`);if(!n)return;let r=n.getBoundingClientRect().left+R.startCol*R.cellWidth,i=t-r,a=Math.floor(i/R.cellWidth),o=i%R.cellWidth/R.cellWidth*100,s=3-R.startCol;a>s&&(a=s,o=100),a<0&&(a=0,o=0),R.currentCol=R.startCol+a,R.progress=o,U()},U=()=>{let e=R.startRow;for(let t=R.startCol;t<=3;t++)L[e][t].active=!1,L[e][t].isStart=!1,L[e][t].isEnd=!1;for(let t=R.startCol;t<=R.currentCol;t++)L[e][t].active=!0,L[e][t].isStart=t===R.startCol,L[e][t].isEnd=t===R.currentCol&&R.progress===100;R.progress>0&&(L[e][R.currentCol].active=!0,L[e][R.currentCol].isStart=!1,L[e][R.currentCol].isEnd=R.progress===100)},W=()=>{if(!R.isDragging)return;let e=R.startRow;if(R.progress>50&&R.currentCol<3){for(let t=R.startCol;t<=3;t++)L[e][t].active=!1,L[e][t].isStart=!1,L[e][t].isEnd=!1;for(let t=R.startCol;t<=R.currentCol+1;t++)L[e][t].active=!0,L[e][t].isStart=t===R.startCol,L[e][t].isEnd=t===R.currentCol+1}else{for(let t=R.startCol;t<=3;t++)L[e][t].active=!1,L[e][t].isStart=!1,L[e][t].isEnd=!1;for(let t=R.startCol;t<=R.currentCol;t++)L[e][t].active=!0,L[e][t].isStart=t===R.startCol,L[e][t].isEnd=t===R.currentCol}R.isDragging=!1,R.startRow=-1,R.startCol=-1,R.currentCol=-1,R.progress=0};n(()=>{document.addEventListener(`mousemove`,H),document.addEventListener(`mouseup`,W),document.addEventListener(`mouseleave`,W)}),r(()=>{document.removeEventListener(`mousemove`,H),document.removeEventListener(`mouseup`,W),document.removeEventListener(`mouseleave`,W)});let G=a(``),K=a(``),q=()=>{G.value=`K`},J=()=>{h.advanceUseCompPath=`/advance-config/first`},Y=()=>{h.advanceUseCompPath=`/advance-config/first`},X=()=>{console.log(`确认配置`,{type:`TGL`,selectedKey:G.value,tglKey:K.value})},Z=o([{id:`press`,name:`按压`,distance:.1,progress:10,color:`#3B82F6`,tooltip:`按键开始被按下的初始阶段`,showTooltip:!1},{id:`bottom`,name:`触底`,distance:3.4,progress:90,color:`#EF4444`,tooltip:`按键完全按下到达最大行程`,showTooltip:!1},{id:`lift`,name:`抬起`,distance:3.4,progress:60,color:`#10B981`,tooltip:`按键从底部开始抬起的阶段`,showTooltip:!1},{id:`reset`,name:`复位`,distance:.1,progress:5,color:`#F59E0B`,tooltip:`按键完全复位到初始位置`,showTooltip:!1}]),Q=e=>{Z[e]&&(Z[e].showTooltip=!0)},$=e=>{Z[e]&&(Z[e].showTooltip=!1)};return(n,r)=>(t(),g(`div`,y,[m(`div`,b,[m(`button`,{class:`back-btn`,onClick:J},[e(c,{"icon-class":`advance_func-arrow_left`})]),r[0]||=m(`div`,{class:`title-group`},[m(`h2`,null,`动态行程（DKS）`),m(`p`,{class:`description`},`单击按键可开关持续触发，长按则正常触发`)],-1),m(`div`,{class:`config-actions`},[m(`div`,{class:`advance-cancel-btn`,onClick:Y},` 取消 `),m(`div`,{class:`confirm-btn`,onClick:X},` 确认 `)])]),m(`div`,x,[m(`div`,S,[r[1]||=m(`div`,{class:`config-title`},[m(`h3`,null,`1.选择按键`),m(`div`,{class:`tooltip`},`请点击上方键盘按键绑定`)],-1),m(`div`,C,[m(`div`,{class:d([`key-box`,{selected:G.value}]),onClick:q},[G.value?(t(),g(`div`,w,l(G.value),1)):s(``,!0)],2)])]),m(`div`,T,[m(`div`,E,[m(`div`,D,[(t(!0),g(u,null,_(Z,(e,n)=>(t(),g(`div`,{key:e.id,class:d([`stage-card`,{"last-stage":n===Z.length-1}]),onMouseenter:e=>Q(n),onMouseleave:e=>$(n)},[m(`span`,k,l(e.name),1),m(`span`,A,l(e.distance),1),r[2]||=m(`span`,{class:`distance-unit`},`mm`,-1),m(`div`,j,[m(`div`,M,[m(`div`,{class:`progress-bar`,style:f({width:`${e.progress}%`,backgroundColor:e.color})},null,4),m(`div`,{class:`progress-marker`,style:f({left:`${e.progress}%`,backgroundColor:e.color})},null,4)])]),m(`div`,{class:d([`stage-tooltip`,{visible:e.showTooltip}])},l(e.tooltip),3)],42,O))),128))]),m(`div`,N,[m(`div`,P,[(t(!0),g(u,null,_(L,(e,n)=>(t(),g(`div`,{key:n,class:`matrix-row`},[(t(!0),g(u,null,_(e,(e,r)=>(t(),g(`div`,{key:r,class:d([`matrix-cell`,{active:e.active,start:e.isStart,end:e.isEnd,dragging:R.isDragging&&R.startRow===n,last:r===3}]),onClick:e=>z(n,r),onMousedown:e=>V(n,r,e)},[m(`div`,I,l(n*4+r+1),1),R.isDragging&&R.startRow===n&&r>=R.startCol&&r<=R.currentCol?(t(),g(`div`,{key:0,class:`drag-progress`,style:f({width:r===R.currentCol?`${R.progress}%`:`100%`})},null,4)):s(``,!0)],42,F))),128))]))),128))])]),r[3]||=m(`div`,{class:`matrix-key-select`},[m(`div`),m(`div`),m(`div`),m(`div`)],-1)]),r[4]||=m(`div`,{class:`info-panel`},[m(`h3`,null,`操作说明`),m(`ul`,null,[m(`li`,null,`点击方格激活起始点`),m(`li`,null,`激活后向右拖动可延长激活区域，拖动时长度实时变化`),m(`li`,null,`拖动时新的激活区域会自动覆盖已有的激活区域`),m(`li`,null,`每行最后一个方格只能激活不能拖动`),m(`li`,null,`可以继续编辑未激活的点`)])],-1)]),e(v)])]))}}),[[`__scopeId`,`data-v-9757ae8f`]]);export{L as default};